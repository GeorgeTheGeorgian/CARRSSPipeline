The Calibration And Reprojection for the Robert Stobie Spectrograph Pipeline (CARRSSPipeline) is a program that is designed to perform flux calibration, wavelength reprojection, and other reductions on multi-object spectroscopy (MOS) taken by the Southern African Large Telescope's Robert Stobie Spectrograph (SALT-RSS). This pipeline is designed to follow RSSMOSPipeline (https://github.com/mattyowl/RSSMOSPipeline.git) and requires the user to manually set up directories. 

Currently, the software works on three gratings; Blue, Green, Red; with two dithers for each grating. However, one can accommodate as many settings as desired by expanding upon the 'get_paths' and 'flux_calibrated_specs' functions. Further developments will make this program more dynamic, but your contribution is welcome in the meantime!

Once SALT-RSS data is obtained, data from each grating and dither must be put into their respective directories in the following manner: .../{mask name}/{grating name}/{dither}

    Example: .../COSMOS-mask-B/PG2300/Dither+  (The pipeline works on two central wavelengths per grating so we suggest naming the upper central wavelength as Dither+ and the lower as Dither-)
                                                                                            
A configuration file is needed that has the mask name and the settings declared. Another configuration file that contains emission line known rest wavelengths is also needed for line inspection. Examples of these files are provided. 

Once all data is properly organized and the configuration files are made, RSSMOSPipeline must be run first to perform flat-field correction, cosmic ray rejection, sky subtraction, and wavelength calibration. We suggest uncommenting lines 2273-2280 in extractAndStackSpectra from RSSMOSPipeline, replacing skuSubbed2d on line 2277 with 'med-np.array([sky]*med.shape[0])' since we prefer not having RSSMOSPipeline uses non-negative least squares optimization to perform sky subtraction. Given we expect our sky to be constant in the spatial axis, this method will work in saving sky subtracted 2D spectra of science images. However when running RSSMOSPipeline on star spectra, we suggest instead commenting out lines 2246-2253 (leaving lines 2273-2280 commented out) since star spectra have much more prominent continua. RSSMOSPipeline will oversubtract sky in these star spectra, but CARRSSPipeline corrects for this. 

Once all spectra are run through RSSMOSPipeline and saved, CARRSSPipeline can now be run. Under 'Run Below', declare the data directory (where the mask directories you made earlier are located) and the name of the configuration file. The user can set a multiplicative bias as well, if known. If not known, this value should be set to 1 for no bias. Our program includes targets with flux-calibrated spectra from literature, allowing us to compare and subsequently calculate the bias specific to our settings and targets. 

The following cells can then be run to perform the various reductions that CARRSSPipeline offers, which include flux calibration, sky subtraction correction (only for star spectra), wavelength reprojection, continuum analysis, and line inspection. 
